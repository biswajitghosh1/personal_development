{% extends "layout.html" %}
{% block content %}
  <h2>Recent Entries</h2>
  <form method="get" class="inline-filter">
    <label for="date">Filter by date</label>
    <input type="date" id="date" name="date" value="{{ request.args.get('date','') }}">
    <button type="submit">Filter</button>
    <a href="{{ url_for('index') }}">Clear</a>
  </form>

  {% if entries %}
    <ul class="entries">
      {% for e in entries %}
        <li class="entry-item {% if e.important %}important{% endif %}">
          <div class="meta">{{ e.entry_date }} — <strong>{{ e.title }}</strong>{% if e.important %} <span class="imp-badge">IMPORTANT</span>{% endif %}</div>
          <div class="content-preview">{{ e.content[:300]|safe }}{% if e.content|length > 300 %}…{% endif %}</div>
          <div class="entry-actions">
            {% if current_user.is_authenticated %}
              <a href="{{ url_for('edit_entry', entry_id=e.id) }}">Edit</a>
              <form method="post" action="{{ url_for('delete_entry', entry_id=e.id) }}" style="display:inline" onsubmit="return confirm('Delete this entry?');">
                <button type="submit">Delete</button>
              </form>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No entries yet. {% if current_user.is_authenticated %}<a href="{{ url_for('add_entry') }}">Add one</a>.{% else %}<a href="{{ url_for('login') }}">Login</a> to add entries.{% endif %}</p>
  {% endif %}
{% endblock %}
